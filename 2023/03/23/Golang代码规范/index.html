

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme="auto">



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/%E5%AD%A6%E6%A0%A1.png">
  <link rel="icon" href="/img/%E5%AD%A6%E6%A0%A1.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="lp">
  <meta name="keywords" content>
  
    <meta name="description" content="本篇文章主要介绍代码编写时需要注意的基本规范，Golang代码安全相关规范可参考[Golang代码安全规范](https:&#x2F;&#x2F;blog.longpi1.com&#x2F;2022&#x2F;12&#x2F;31&#x2F;Golang%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E8%A7%84%E8%8C%83&#x2F;)，大家有其他相关思路，欢迎提出；">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang代码规范">
<meta property="og:url" content="https://blog.longpi1.com/2023/03/23/Golang%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/index.html">
<meta property="og:site_name" content="lp&#39;s blog">
<meta property="og:description" content="本篇文章主要介绍代码编写时需要注意的基本规范，Golang代码安全相关规范可参考[Golang代码安全规范](https:&#x2F;&#x2F;blog.longpi1.com&#x2F;2022&#x2F;12&#x2F;31&#x2F;Golang%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E8%A7%84%E8%8C%83&#x2F;)，大家有其他相关思路，欢迎提出；">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-03-23T14:25:42.000Z">
<meta property="article:modified_time" content="2023-03-24T13:12:14.448Z">
<meta property="article:author" content="lp">
<meta property="article:tag" content="原创">
<meta property="article:tag" content="golang">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Golang代码规范 - lp&#39;s blog</title>

  <link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css">



  <link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css">

  <link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css">

  <link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css">



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link rel="stylesheet" href="/css/main.css">


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css">
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css">
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.longpi1.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":30,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"UvaCwj6C0pVj9XCWuMtLaBWJ-gzGzoHsz","app_key":"w2xUk9wycItSqrREmRMDYJHY","server_url":"https://uvacwj6c.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script src="/js/utils.js"></script>
  <script src="/js/color-schema.js"></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>lp&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                文章分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax="true" style="background: url('/img/bg.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Golang代码规范"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-03-23 22:25" pubdate>
          2023年3月23日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k 字
        
      </span>
    

  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>


    <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/longpi1"><img loading="lazy" width="149" height="149" src="https://github.blog/wp-content/uploads/2008/12/forkme_left_darkblue_121621.png?resize=149%2C149" srcset="/img/loading.gif" lazyload class="attachment-full size-full" alt="follow me on GitHub" data-recalc-dims="1"></a>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Golang代码规范</h1>
            
            
              <div class="markdown-body">
              <meta name="referrer" content="no-referrer">
                
                <h1 id="Golang代码规范"><a href="#Golang代码规范" class="headerlink" title="Golang代码规范"></a>Golang代码规范</h1><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h2><p>本篇文章主要介绍代码编写时需要注意的基本规范，Golang代码安全相关规范可参考<a href="https://blog.longpi1.com/2022/12/31/Golang%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8%E8%A7%84%E8%8C%83/">Golang代码安全规范</a>，大家有其他相关思路，欢迎提出；</p>
<h2 id="2-编程规约"><a href="#2-编程规约" class="headerlink" title="2 编程规约"></a>2 编程规约</h2><h3 id="2-1-命名风格"><a href="#2-1-命名风格" class="headerlink" title="2.1 命名风格"></a>2.1 命名风格</h3><ul>
<li><p>【强制】代码中的命名均不能以<strong>特殊字符</strong>开始和结束，包含常见的中划线、下划线等。</p>
<p>反例:</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang">_name; -name; __name; --name; $name; %name<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】参数名、局部变量都统一使用<strong>lowerCamelCase</strong>(<strong>小驼峰</strong>)风格。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">demo</span><span class="hljs-params">(ctx context.Context, name <span class="hljs-type">string</span>)</span></span> &#123;<br>    <span class="hljs-keyword">var</span> localVar <span class="hljs-type">string</span><br>    <span class="hljs-comment">// other operations</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【推荐】全局变量统一使用<strong>小驼峰</strong>风格。包外引用需要提供相应的导出函数对外导出使用。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">var</span> globalVar <span class="hljs-type">string</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Set</span><span class="hljs-params">(value <span class="hljs-type">string</span>)</span></span> &#123;<br>    globalVar = value<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】函数名和方法(method)的命名区分导出和非导出类型。对于包内非导出的函数或方法使用小驼峰风格。对于导出的函数或方法采用<strong>UpperCamelCase</strong>(<strong>大驼峰</strong>)风格。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">localFunction</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br><br><span class="hljs-keyword">type</span> sample <span class="hljs-keyword">struct</span> &#123;&#125;<br><br><span class="hljs-comment">// Show print hello</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *sample)</span></span> Show() &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Hello Blueking.&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】struct的命名区分导出和非导出类型。对于包内非导出的struct使用<strong>小驼峰</strong>风格。对于导出的struct采用<strong>大驼峰</strong>风格。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> unexportedSample <span class="hljs-keyword">struct</span> &#123;&#125;<br><br><span class="hljs-comment">// ExportedSample exported sample</span><br><span class="hljs-keyword">type</span> ExportedSample <span class="hljs-keyword">struct</span> &#123;&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】常量命名使用大驼峰风格，不要使用下划线分隔，力求语义表达完整清楚，不要嫌名字长。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang">MaxConnectionCount<br></code></pre></td></tr></table></figure>

<p>反例</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs golang">MAX_CNNECTION_COUNT<br></code></pre></td></tr></table></figure>
</li>
<li><p>【推荐】接口(interface)采用<strong>大驼峰</strong>的风格命名。具体细分为以下三种情况：</p>
<ul>
<li><p>单个函数的接口名以“er”作为后缀，如Reader, Writer。而接口的实现则去掉“er”。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> &#123;<br>    Read(p []<span class="hljs-type">byte</span>) (n <span class="hljs-type">int</span>, err <span class="hljs-type">error</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>两个函数的接口名缩合两个函数名</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> WriteFlusher <span class="hljs-keyword">interface</span> &#123;<br>    Write([]<span class="hljs-type">byte</span>) (<span class="hljs-type">int</span>, <span class="hljs-type">error</span>)<br>    Flush() <span class="hljs-type">error</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>三个以上函数的接口名，类似于结构体名</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> Car <span class="hljs-keyword">interface</span> &#123;<br>    Start([]<span class="hljs-type">byte</span>)<br>    Stop() <span class="hljs-type">error</span><br>    Recover()<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>【强制】包名统一采用小写风格，使用短命名，不能包含特殊字符（下划线、中划线等）语义表达准确。建议最好是一个单词。使用多级目录来划分层级。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> client<br><span class="hljs-keyword">package</span> clientset<br></code></pre></td></tr></table></figure>

<p>反例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> Demo<br><span class="hljs-keyword">package</span> Demo_Case<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】杜绝不规范的缩写，避免望文不生意。不必要进行缩写时，避免进行缩写。<strong>对于专 用名词如URL&#x2F;CMDB&#x2F;GSE等，在使用时要保证全名统一为大写或小写。不能出现部分大写和小写混用的情况。</strong></p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setURL</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetURL</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>反例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">var</span> sidecarUrl <span class="hljs-type">string</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ResetUrl</span><span class="hljs-params">()</span></span>  &#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br></code></pre></td></tr></table></figure>


</li>
<li><p>【推荐】如果包、struct、interface等使用了设计模式，在命名时需要体现出对应的设计模式。这有利于阅读者快速理解代码的设计架构和设计理念。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> ContainerFactory <span class="hljs-keyword">interface</span> &#123;<br>    Create(id <span class="hljs-type">string</span>, config *configs.Config) (Container, <span class="hljs-type">error</span>)<br>    Load(id <span class="hljs-type">string</span>) (Container, <span class="hljs-type">error</span>)<br>    StartInitialization() <span class="hljs-type">error</span><br>    Type() <span class="hljs-type">string</span><br>&#125;<br><span class="hljs-keyword">type</span> PersonDecorator <span class="hljs-keyword">interface</span> &#123;<br>    SetName(name <span class="hljs-type">string</span>) PersonDecorator<br>    SetAge(age <span class="hljs-type">uint</span>) PersonDecorator<br>    Show()<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-常量定义"><a href="#2-2-常量定义" class="headerlink" title="2.2 常量定义"></a>2.2 常量定义</h3><ul>
<li><p>【强制】对于多个具有枚举特性的类型，要求定义成为类型，并利用常量进行枚举。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> EventType <span class="hljs-type">string</span><br><span class="hljs-keyword">const</span> (<br>    Create EventType = <span class="hljs-string">&quot;create&quot;</span><br>    Update EventType = <span class="hljs-string">&quot;update&quot;</span><br>    Get    EventType = <span class="hljs-string">&quot;get&quot;</span><br>    Delete EventType = <span class="hljs-string">&quot;delete&quot;</span><br>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】<strong>不允许任何未经定义的常量直接在代码中使用。</strong></p>
</li>
</ul>
<h3 id="2-3-代码格式"><a href="#2-3-代码格式" class="headerlink" title="2.3 代码格式"></a>2.3 代码格式</h3><ul>
<li>【强制】采用4个空格的缩进，每个tab也代表4个空格。这是唯一能够保证在所有环境下获得一致展现的方法。</li>
<li>【强制】运算符(:&#x3D;, &#x3D;等)的左右两侧必须要加一个空格（符合gofmt逻辑）。</li>
<li>【强制】作为输入参数或者数组下标时，运算符和运算数之间不需要空格，紧凑展示（符合gofmt逻辑）。</li>
<li>【强制】提交的代码必须经过gofmt格式化。很多IDE支持自动gofmt格式化。</li>
<li>【推荐】代码最大行宽为120列，超过换行。</li>
</ul>
<h3 id="2-4-控制语句"><a href="#2-4-控制语句" class="headerlink" title="2.4 控制语句"></a>2.4 控制语句</h3><h4 id="2-4-1-if"><a href="#2-4-1-if" class="headerlink" title="2.4.1 if"></a>2.4.1 if</h4><ul>
<li><p>【强制】if接受一个初始化语句，<strong>对于返回参数不需要流入到下一个语句时，通过建立局部变量的方式构建if判断语句。</strong></p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">if</span> err := file.Chmod(<span class="hljs-number">0664</span>); err != <span class="hljs-literal">nil</span> &#123;<br>    <span class="hljs-keyword">return</span> err<br>&#125;<br></code></pre></td></tr></table></figure>


</li>
<li><p>【强制】对于遍历数据(如map)的场景，如果只使用第一项，则直接丢弃第二项。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">for</span> key := <span class="hljs-keyword">range</span> mapper &#123;<br>    codeUsing(key)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>反例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">for</span> key, _ := <span class="hljs-keyword">range</span> mapper &#123;<br>    codeUsing(key)<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-5-注释规约"><a href="#2-5-注释规约" class="headerlink" title="2.5 注释规约"></a>2.5 注释规约</h3><ul>
<li><p>【强制】注释必须是完整的句子，以句点作为结尾。</p>
</li>
<li><p>【强制】使用行间注释时，如果注释行与上一行不属于同一代码层级，不用空行。如果属于同行，则空一行再进行注释。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">demo</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// This is a start line of a new block, do not need a new line </span><br>    <span class="hljs-comment">// with the previous code.</span><br>    say(<span class="hljs-string">&quot;knock, knock!&quot;</span>)<br>    <br>    <span class="hljs-comment">// This is the same block with the previous code,</span><br>    <span class="hljs-comment">// you should insert a new line before you start a comment.</span><br>    echo(<span class="hljs-string">&quot;who is there ?&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】使用 &#x2F;&#x2F; 进行注释时, 和注释语句之间必须有一个空格。增加可读性。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// validator is used to validate dns&#x27;s format.</span><br><span class="hljs-comment">// should not contains dot, underscore character, etc.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">validator</span><span class="hljs-params">(dns <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>    <span class="hljs-comment">// do validate.</span><br><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】<strong>不要使用尾注释</strong></p>
<p>反例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">show</span><span class="hljs-params">(name <span class="hljs-type">string</span>)</span></span> &#123;<br>    display(name) <span class="hljs-comment">// show a man&#x27;s information</span><br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】使用&#x2F;**&#x2F;风格进行多行注释时，首&#x2F;<em>和尾</em>&#x2F;两行内容中不能包含注释内容，也不能包含额外的内容，如星号横幅等。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">/*</span><br><span class="hljs-comment">The syntax of the regular expressions accepted is:</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    regexp:</span><br><span class="hljs-comment">        concatenation &#123; &#x27;|&#x27; concatenation &#125;</span><br><span class="hljs-comment">    concatenation:</span><br><span class="hljs-comment">        &#123; closure &#125;</span><br><span class="hljs-comment">    closure:</span><br><span class="hljs-comment">        term [ &#x27;*&#x27; | &#x27;+&#x27; | &#x27;?&#x27; ]</span><br><span class="hljs-comment">    term:</span><br><span class="hljs-comment">        &#x27;^&#x27;</span><br><span class="hljs-comment">        &#x27;$&#x27;</span><br><span class="hljs-comment">        &#x27;.&#x27;</span><br><span class="hljs-comment">        character</span><br><span class="hljs-comment">        &#x27;[&#x27; [ &#x27;^&#x27; ] character-ranges &#x27;]&#x27;</span><br><span class="hljs-comment">        &#x27;(&#x27; regexp &#x27;)&#x27;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】注释的单行长度最大不能超过120列，超过必须换行。一般以80列换行为宜。</p>
</li>
<li><p>【推荐】函数与方法的注释需要以函数或方法的名称作为开头。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-comment">// HasPrefix tests whether the string s begins with prefix.</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HasPrefix</span><span class="hljs-params">(s, prefix <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">bool</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(s) &gt;= <span class="hljs-built_in">len</span>(prefix) &amp;&amp; s[<span class="hljs-number">0</span>:<span class="hljs-built_in">len</span>(prefix)] == prefix<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【推荐】大段注释采用&#x2F;**&#x2F;风格进行注释。</p>
</li>
<li><p>【推荐】包中的每一个导出的函数、方法、结构体和常量都应该有相应的注释。</p>
</li>
<li><p>【推荐】对于特别复杂的包说明，可以单独创建doc.go文件来详细说明。</p>
</li>
</ul>
<h3 id="2-6-interface-的指针"><a href="#2-6-interface-的指针" class="headerlink" title="2.6 interface 的指针"></a>2.6 interface 的指针</h3><p>您几乎不需要指向接口类型的指针。您应该将接口作为值进行传递，在这样的传递过程中，实质上传递的底层数据仍然可以是指针。</p>
<p>接口实质上在底层用两个字段表示：</p>
<ol>
<li>一个指向某些特定类型信息的指针。您可以将其视为”type”。</li>
<li>数据指针。如果存储的数据是指针，则直接存储。如果存储的数据是一个值，则存储指向该值的指针。</li>
</ol>
<p>如果希望接口方法修改基础数据，则必须使用指针传递 (将对象指针赋值给接口变量)。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">type</span> F <span class="hljs-keyword">interface</span> &#123;<br>  f()<br>&#125;<br><br><span class="hljs-keyword">type</span> S1 <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s S1)</span></span> f() &#123;&#125;<br><br><span class="hljs-keyword">type</span> S2 <span class="hljs-keyword">struct</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *S2)</span></span> f() &#123;&#125;<br><br><span class="hljs-comment">// f1.f() 无法修改底层数据</span><br><span class="hljs-comment">// f2.f() 可以修改底层数据，给接口变量 f2 赋值时使用的是对象指针</span><br><span class="hljs-keyword">var</span> f1 F = S1&#123;&#125;<br><span class="hljs-keyword">var</span> f2 F = &amp;S2&#123;&#125;<br></code></pre></td></tr></table></figure>



<h3 id="2-7-其它"><a href="#2-7-其它" class="headerlink" title="2.7 其它"></a>2.7 其它</h3><h4 id="2-7-1-参数传递"><a href="#2-7-1-参数传递" class="headerlink" title="2.7.1 参数传递"></a>2.7.1 参数传递</h4><ul>
<li>【推荐】对于少量数据，不要通过指针传递。</li>
<li>【推荐】对于大量(&gt;&#x3D;4)的入参，考虑使用struct进行封装，并通过指针传递。</li>
<li>【强制】传参是map, slice, chan 不要使用指针进行传递。因为这三者是引用类型。</li>
</ul>
<h4 id="2-7-2-接受者（receiver）"><a href="#2-7-2-接受者（receiver）" class="headerlink" title="2.7.2 接受者（receiver）"></a>2.7.2 接受者（receiver）</h4><ul>
<li><p>【推荐】名称统一采用1~3个字母，不宜太长。</p>
</li>
<li><p>【推荐】对于绝在多数可以使用指针接受者的场景，推荐使用指针接受者(point receiver)会更有效率。</p>
</li>
<li><p>【强制】如果接受者是map, slice, chan，不能使用指针接受者。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> queue <span class="hljs-keyword">chan</span> <span class="hljs-keyword">interface</span>&#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q queue)</span></span> Push(i <span class="hljs-keyword">interface</span>&#123;&#125;) &#123;<br>    q &lt;- i<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q queue)</span></span> Pop() <span class="hljs-keyword">interface</span>&#123;&#125; &#123;<br>    <span class="hljs-keyword">return</span> &lt;-q<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    c := <span class="hljs-built_in">make</span>(queue, <span class="hljs-number">1</span>)<br>    c.Push(<span class="hljs-string">&quot;i&quot;</span>)<br>    fmt.Println(c.Pop())<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】如果接受者是包含有锁(sync.Mutex等)，必须使用指针接受者。</p>
</li>
</ul>
<h4 id="2-7-3-启动任何一个goroutine都要先想好如何退出"><a href="#2-7-3-启动任何一个goroutine都要先想好如何退出" class="headerlink" title="2.7.3 启动任何一个goroutine都要先想好如何退出"></a>2.7.3 启动任何一个goroutine都要先想好如何退出</h4><h4 id="2-7-4-return-err的时候清理本无需启动的goroutine"><a href="#2-7-4-return-err的时候清理本无需启动的goroutine" class="headerlink" title="2.7.4 return err的时候清理本无需启动的goroutine"></a>2.7.4 return err的时候清理本无需启动的goroutine</h4><h4 id="2-7-5-想好如何合理优雅Stop"><a href="#2-7-5-想好如何合理优雅Stop" class="headerlink" title="2.7.5 想好如何合理优雅Stop"></a>2.7.5 想好如何合理优雅Stop</h4><h4 id="2-7-6-使用done-chan退出goroutine的时候，不要做任何清理资源的操作。清理资源优先使用defer，因为当goroutine-panic的时候，-defer还能够清理资源，而done-chan中的清理逻辑可能永远不会被执行"><a href="#2-7-6-使用done-chan退出goroutine的时候，不要做任何清理资源的操作。清理资源优先使用defer，因为当goroutine-panic的时候，-defer还能够清理资源，而done-chan中的清理逻辑可能永远不会被执行" class="headerlink" title="2.7.6 使用done chan退出goroutine的时候，不要做任何清理资源的操作。清理资源优先使用defer，因为当goroutine panic的时候， defer还能够清理资源，而done chan中的清理逻辑可能永远不会被执行"></a>2.7.6 使用done chan退出goroutine的时候，不要做任何清理资源的操作。清理资源优先使用defer，因为当goroutine panic的时候， defer还能够清理资源，而done chan中的清理逻辑可能永远不会被执行</h4><h4 id="2-7-7-不建议使用time-after-。使用time-NewTicker-代替，并及时清理ticker"><a href="#2-7-7-不建议使用time-after-。使用time-NewTicker-代替，并及时清理ticker" class="headerlink" title="2.7.7 不建议使用time.after()。使用time.NewTicker()代替，并及时清理ticker"></a>2.7.7 不建议使用<code>time.after()</code>。使用<code>time.NewTicker()</code>代替，并及时清理ticker</h4><h4 id="2-7-8-关闭-Stop-插件的时候注意关闭的顺序和资源释放，-不要造成其他goroutine夯住-例如供外部写的0容量的chan没有处理，但是读的goroutine退出了，导致外部写的goroutine一直阻塞"><a href="#2-7-8-关闭-Stop-插件的时候注意关闭的顺序和资源释放，-不要造成其他goroutine夯住-例如供外部写的0容量的chan没有处理，但是读的goroutine退出了，导致外部写的goroutine一直阻塞" class="headerlink" title="2.7.8 关闭(Stop)插件的时候注意关闭的顺序和资源释放， 不要造成其他goroutine夯住(例如供外部写的0容量的chan没有处理，但是读的goroutine退出了，导致外部写的goroutine一直阻塞)"></a>2.7.8 关闭(Stop)插件的时候注意关闭的顺序和资源释放， 不要造成其他goroutine夯住(例如供外部写的0容量的chan没有处理，但是读的goroutine退出了，导致外部写的goroutine一直阻塞)</h4><h3 id="2-8-在边界处拷贝-Slices-和-Maps"><a href="#2-8-在边界处拷贝-Slices-和-Maps" class="headerlink" title="2.8 在边界处拷贝 Slices 和 Maps"></a>2.8 在边界处拷贝 Slices 和 Maps</h3><p>slices 和 maps 包含了指向底层数据的指针，因此在需要复制它们时要特别注意。</p>
<h4 id="2-8-1-接收-Slices-和-Maps"><a href="#2-8-1-接收-Slices-和-Maps" class="headerlink" title="2.8.1 接收 Slices 和 Maps"></a>2.8.1 接收 Slices 和 Maps</h4><p>请记住，当 map 或 slice 作为函数参数传入时，如果您存储了对它们的引用，则用户可以对其进行修改。</p>
<p>正例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Driver)</span></span> SetTrips(trips []Trip) &#123;<br>  d.trips = <span class="hljs-built_in">make</span>([]Trip, <span class="hljs-built_in">len</span>(trips))<br>  <span class="hljs-built_in">copy</span>(d.trips, trips)<br>&#125;<br><br>trips := ...<br>d1.SetTrips(trips)<br><br><span class="hljs-comment">// 这里我们修改 trips[0]，但不会影响到 d1.trips</span><br>trips[<span class="hljs-number">0</span>] = ...<br></code></pre></td></tr></table></figure>



<h4 id="2-8-2-返回-slices-或-maps"><a href="#2-8-2-返回-slices-或-maps" class="headerlink" title="2.8.2 返回 slices 或 maps"></a>2.8.2 返回 slices 或 maps</h4><p>同样，请注意用户对暴露内部状态的 map 或 slice 的修改。</p>
<p>正例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Stats <span class="hljs-keyword">struct</span> &#123;<br>  mu sync.Mutex<br><br>  counters <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stats)</span></span> Snapshot() <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span> &#123;<br>  s.mu.Lock()<br>  <span class="hljs-keyword">defer</span> s.mu.Unlock()<br><br>  result := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-built_in">len</span>(s.counters))<br>  <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> s.counters &#123;<br>    result[k] = v<br>  &#125;<br>  <span class="hljs-keyword">return</span> result<br>&#125;<br><br><span class="hljs-comment">// snapshot 现在是一个拷贝</span><br>snapshot := stats.Snapshot()<br></code></pre></td></tr></table></figure>

<p>反例</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Stats <span class="hljs-keyword">struct</span> &#123;<br>  mu sync.Mutex<br><br>  counters <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span><br>&#125;<br><br><span class="hljs-comment">// Snapshot 返回当前状态。</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Stats)</span></span> Snapshot() <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span> &#123;<br>  s.mu.Lock()<br>  <span class="hljs-keyword">defer</span> s.mu.Unlock()<br><br>  <span class="hljs-keyword">return</span> s.counters<br>&#125;<br><br><span class="hljs-comment">// snapshot 不再受互斥锁保护</span><br><span class="hljs-comment">// 因此对 snapshot 的任何访问都将受到数据竞争的影响</span><br><span class="hljs-comment">// 影响 stats.counters</span><br>snapshot := stats.Snapshot()<br></code></pre></td></tr></table></figure>



<h3 id="2-9-使用-defer-释放资源"><a href="#2-9-使用-defer-释放资源" class="headerlink" title="2.9 使用 defer 释放资源"></a>2.9 使用 defer 释放资源</h3><p>使用 defer 释放资源，诸如文件和锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br>p.Lock()<br><span class="hljs-keyword">defer</span> p.Unlock()<br><br><span class="hljs-keyword">if</span> p.count &lt; <span class="hljs-number">10</span> &#123;<br>  <span class="hljs-keyword">return</span> p.count<br>&#125;<br><br>p.count++<br><span class="hljs-keyword">return</span> p.count<br><br><span class="hljs-comment">// 更可读</span><br>反例：<br>p.Lock()<br><span class="hljs-keyword">if</span> p.count &lt; <span class="hljs-number">10</span> &#123;<br>  p.Unlock()<br>  <span class="hljs-keyword">return</span> p.count<br>&#125;<br><br>p.count++<br>newCount := p.count<br>p.Unlock()<br><br><span class="hljs-keyword">return</span> newCount<br><br><span class="hljs-comment">// 当有多个 return 分支时，很容易遗忘 unlock</span><br></code></pre></td></tr></table></figure>

<p>Defer 的开销非常小，只有在您可以证明函数执行时间处于纳秒级的程度时，才应避免这样做。使用 defer 提升可读性是值得的，因为使用它们的成本微不足道。尤其适用于那些不仅仅是简单内存访问的较大的方法，在这些方法中其他计算的资源消耗远超过 <code>defer</code>。</p>
<h3 id="2-10-不要使用-panic"><a href="#2-10-不要使用-panic" class="headerlink" title="2.10 不要使用 panic"></a>2.10 不要使用 panic</h3><p>在生产环境中运行的代码必须避免出现 panic。panic 是 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Cascading_failure">级联失败</a> 的主要根源 。如果发生错误，该函数必须返回错误，并允许调用方决定如何处理它。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">(args []<span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) == <span class="hljs-number">0</span> &#123;<br>    <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">&quot;an argument is required&quot;</span>)<br>  &#125;<br>  <span class="hljs-comment">// ...</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">if</span> err := run(os.Args[<span class="hljs-number">1</span>:]); err != <span class="hljs-literal">nil</span> &#123;<br>    fmt.Fprintln(os.Stderr, err)<br>    os.Exit(<span class="hljs-number">1</span>)<br>  &#125;<br>&#125;<br><br>反例：<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">run</span><span class="hljs-params">(args []<span class="hljs-type">string</span>)</span></span> &#123;<br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) == <span class="hljs-number">0</span> &#123;<br>    <span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;an argument is required&quot;</span>)<br>  &#125;<br>  <span class="hljs-comment">// ...</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  run(os.Args[<span class="hljs-number">1</span>:])<br>&#125;<br></code></pre></td></tr></table></figure>

<p>panic&#x2F;recover 不是错误处理策略。仅当发生不可恢复的事情（例如：nil 引用）时，程序才必须 panic。程序初始化是一个例外：程序启动时应使程序中止的不良情况可能会引起 panic。</p>
<h3 id="2-11-避免可变全局变量"><a href="#2-11-避免可变全局变量" class="headerlink" title="2.11 避免可变全局变量"></a>2.11 避免可变全局变量</h3><p>使用选择依赖注入方式避免改变全局变量。 既适用于函数指针又适用于其他值类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-comment">// sign.go</span><br><span class="hljs-keyword">type</span> signer <span class="hljs-keyword">struct</span> &#123;<br>  now <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> time.Time<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newSigner</span><span class="hljs-params">()</span></span> *signer &#123;<br>  <span class="hljs-keyword">return</span> &amp;signer&#123;<br>    now: time.Now,<br>  &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *signer)</span></span> Sign(msg <span class="hljs-type">string</span>) <span class="hljs-type">string</span> &#123;<br>  now := s.now()<br>  <span class="hljs-keyword">return</span> signWithTime(msg, now)<br>&#125;<br><br>反例：<br><span class="hljs-comment">// sign.go</span><br><span class="hljs-keyword">var</span> _timeNow = time.Now<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sign</span><span class="hljs-params">(msg <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> &#123;<br>  now := _timeNow()<br>  <span class="hljs-keyword">return</span> signWithTime(msg, now)<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="2-12-避免使用-init"><a href="#2-12-避免使用-init" class="headerlink" title="2.12 避免使用 init()"></a>2.12 避免使用 <code>init()</code></h3><p>尽可能避免使用<code>init()</code>。当<code>init()</code>是不可避免或可取的，代码应先尝试：</p>
<ol>
<li>无论程序环境或调用如何，都要完全确定。</li>
<li>避免依赖于其他<code>init()</code>函数的顺序或副作用。虽然<code>init()</code>顺序是明确的，但代码可以更改， 因此<code>init()</code>函数之间的关系可能会使代码变得脆弱和容易出错。</li>
<li>避免访问或操作全局或环境状态，如机器信息、环境变量、工作目录、程序参数&#x2F;输入等。</li>
<li>避免<code>I/O</code>，包括文件系统、网络和系统调用。</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-keyword">var</span> _defaultFoo = Foo&#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br><span class="hljs-comment">// or，为了更好的可测试性：</span><br><span class="hljs-keyword">var</span> _defaultFoo = defaultFoo()<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">defaultFoo</span><span class="hljs-params">()</span></span> Foo &#123;<br>    <span class="hljs-keyword">return</span> Foo&#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br><br>反例：<br><br><span class="hljs-keyword">type</span> Foo <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br><span class="hljs-keyword">var</span> _defaultFoo Foo<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span> &#123;<br>    _defaultFoo = Foo&#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不能满足这些要求的代码可能属于要作为<code>main()</code>调用的一部分（或程序生命周期中的其他地方）， 或者作为<code>main()</code>本身的一部分写入。特别是，打算由其他程序使用的库应该特别注意完全确定性， 而不是执行“init magic”</p>
<h3 id="2-13-追加时优先指定切片容量"><a href="#2-13-追加时优先指定切片容量" class="headerlink" title="2.13 追加时优先指定切片容量"></a>2.13 追加时优先指定切片容量</h3><p>在尽可能的情况下，在初始化要追加的切片时为<code>make()</code>提供一个容量值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-keyword">for</span> n := <span class="hljs-number">0</span>; n &lt; b.N; n++ &#123;<br>  data := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>, size)<br>  <span class="hljs-keyword">for</span> k := <span class="hljs-number">0</span>; k &lt; size; k++&#123;<br>    data = <span class="hljs-built_in">append</span>(data, k)<br>  &#125;<br>&#125;<br><br>反例：<br><span class="hljs-keyword">for</span> n := <span class="hljs-number">0</span>; n &lt; b.N; n++ &#123;<br>  data := <span class="hljs-built_in">make</span>([]<span class="hljs-type">int</span>, <span class="hljs-number">0</span>)<br>  <span class="hljs-keyword">for</span> k := <span class="hljs-number">0</span>; k &lt; size; k++&#123;<br>    data = <span class="hljs-built_in">append</span>(data, k)<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="2-14-不要一劳永逸地使用-goroutine"><a href="#2-14-不要一劳永逸地使用-goroutine" class="headerlink" title="2.14 不要一劳永逸地使用 goroutine"></a>2.14 不要一劳永逸地使用 goroutine</h3><p>Goroutines 是轻量级的，但它们不是免费的： 至少，它们会为堆栈和 CPU 的调度消耗内存。 虽然这些成本对于 Goroutines 的使用来说很小，但当它们在没有受控生命周期的情况下大量生成时会导致严重的性能问题。 具有非托管生命周期的 Goroutines 也可能导致其他问题，例如防止未使用的对象被垃圾回收并保留不再使用的资源。</p>
<p>因此，不要在代码中泄漏 goroutine。 使用 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://pkg.go.dev/go.uber.org/goleak">go.uber.org&#x2F;goleak</a> 来测试可能产生 goroutine 的包内的 goroutine 泄漏。</p>
<p>一般来说，每个 goroutine:</p>
<ul>
<li>必须有一个可预测的停止运行时间； 或者</li>
<li>必须有一种方法可以向 goroutine 发出信号它应该停止</li>
</ul>
<p>在这两种情况下，都必须有一种方式代码来阻塞并等待 goroutine 完成。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-keyword">var</span> (<br>  stop = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;) <span class="hljs-comment">// 告诉 goroutine 停止</span><br>  done = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;) <span class="hljs-comment">// 告诉我们 goroutine 退出了</span><br>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">defer</span> <span class="hljs-built_in">close</span>(done)<br>  ticker := time.NewTicker(delay)<br>  <span class="hljs-keyword">defer</span> ticker.Stop()<br>  <span class="hljs-keyword">for</span> &#123;<br>    <span class="hljs-keyword">select</span> &#123;<br>    <span class="hljs-keyword">case</span> &lt;-tick.C:<br>      flush()<br>    <span class="hljs-keyword">case</span> &lt;-stop:<br>      <span class="hljs-keyword">return</span><br>    &#125;<br>  &#125;<br>&#125;()<br><span class="hljs-comment">// 其它...</span><br><span class="hljs-built_in">close</span>(stop)  <span class="hljs-comment">// 指示 goroutine 停止</span><br>&lt;-done       <span class="hljs-comment">// and wait for it to exit</span><br><br>反例：<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">for</span> &#123;<br>    flush()<br>    time.Sleep(delay)<br>  &#125;<br>&#125;()<br><br><br></code></pre></td></tr></table></figure>



<h3 id="2-15-减少嵌套"><a href="#2-15-减少嵌套" class="headerlink" title="2.15 减少嵌套"></a>2.15 减少嵌套</h3><p>代码应通过尽可能先处理错误情况&#x2F;特殊情况并尽早返回或继续循环来减少嵌套。减少嵌套多个级别的代码的代码量。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> data &#123;<br>  <span class="hljs-keyword">if</span> v.F1 != <span class="hljs-number">1</span> &#123;<br>    log.Printf(<span class="hljs-string">&quot;Invalid v: %v&quot;</span>, v)<br>    <span class="hljs-keyword">continue</span><br>  &#125;<br><br>  v = process(v)<br>  <span class="hljs-keyword">if</span> err := v.Call(); err != <span class="hljs-literal">nil</span> &#123;<br>    <span class="hljs-keyword">return</span> err<br>  &#125;<br>  v.Send()<br>&#125;<br>反例：<br><span class="hljs-keyword">for</span> _, v := <span class="hljs-keyword">range</span> data &#123;<br>  <span class="hljs-keyword">if</span> v.F1 == <span class="hljs-number">1</span> &#123;<br>    v = process(v)<br>    <span class="hljs-keyword">if</span> err := v.Call(); err == <span class="hljs-literal">nil</span> &#123;<br>      v.Send()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> err<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    log.Printf(<span class="hljs-string">&quot;Invalid v: %v&quot;</span>, v)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="2-16-不必要的-else"><a href="#2-16-不必要的-else" class="headerlink" title="2.16  不必要的 else"></a>2.16  不必要的 else</h3><p>如果在 if 的两个分支中都设置了变量，则可以将其替换为单个 if。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br>a := <span class="hljs-number">10</span><br><span class="hljs-keyword">if</span> b &#123;<br>  a = <span class="hljs-number">100</span><br>&#125;<br>反例：<br><span class="hljs-keyword">var</span> a <span class="hljs-type">int</span><br><span class="hljs-keyword">if</span> b &#123;<br>  a = <span class="hljs-number">100</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  a = <span class="hljs-number">10</span><br>&#125;<br><br></code></pre></td></tr></table></figure>



<h3 id="2-17-初始化-Maps"><a href="#2-17-初始化-Maps" class="headerlink" title="2.17 初始化 Maps"></a>2.17 初始化 Maps</h3><p>对于空 map 请使用 <code>make(..)</code> 初始化， 并且 map 是通过编程方式填充的。 这使得 map 初始化在表现上不同于声明，并且它还可以方便地在 make 后添加大小提示。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-keyword">var</span> (<br>  <span class="hljs-comment">// m1 读写安全;</span><br>  <span class="hljs-comment">// m2 在写入时会 panic</span><br>  m1 = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[T1]T2)<br>  m2 <span class="hljs-keyword">map</span>[T1]T2<br>)<br>反例：<br><span class="hljs-keyword">var</span> (<br>  <span class="hljs-comment">// m1 读写安全;</span><br>  <span class="hljs-comment">// m2 在写入时会 panic</span><br>  m1 = <span class="hljs-keyword">map</span>[T1]T2&#123;&#125;<br>  m2 <span class="hljs-keyword">map</span>[T1]T2<br>)<br><br>声明和初始化看起来差别非常大。<br></code></pre></td></tr></table></figure>



<h2 id="3-性能"><a href="#3-性能" class="headerlink" title="3 性能"></a>3 性能</h2><p>性能方面的特定准则只适用于高频场景。</p>
<h3 id="3-1-优先使用-strconv-而不是-fmt"><a href="#3-1-优先使用-strconv-而不是-fmt" class="headerlink" title="3.1 优先使用 strconv 而不是 fmt"></a>3.1 优先使用 strconv 而不是 fmt</h3><p>将原语转换为字符串或从字符串转换时，<code>strconv</code>速度比<code>fmt</code>快。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>  s := strconv.Itoa(rand.Int())<br>&#125;<br>BenchmarkStrconv<span class="hljs-number">-4</span>    <span class="hljs-number">64.2</span> ns/op    <span class="hljs-number">1</span> allocs/op<br>反例：<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>  s := fmt.Sprint(rand.Int())<br>&#125;<br>BenchmarkFmtSprint<span class="hljs-number">-4</span>    <span class="hljs-number">143</span> ns/op    <span class="hljs-number">2</span> allocs/op<br></code></pre></td></tr></table></figure>



<h3 id="3-2-避免字符串到字节的转换"><a href="#3-2-避免字符串到字节的转换" class="headerlink" title="3.2 避免字符串到字节的转换"></a>3.2 避免字符串到字节的转换</h3><p>不要反复从固定字符串创建字节 slice。相反，请执行一次转换并捕获结果。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br>data := []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Hello world&quot;</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>  w.Write(data)<br>&#125;<br>BenchmarkGood<span class="hljs-number">-4</span>  <span class="hljs-number">500000000</span>   <span class="hljs-number">3.25</span> ns/op<br>反例：<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>  w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Hello world&quot;</span>))<br>&#125;<br>BenchmarkBad<span class="hljs-number">-4</span>   <span class="hljs-number">50000000</span>   <span class="hljs-number">22.2</span> ns/op<br></code></pre></td></tr></table></figure>



<h3 id="3-3-指定容器容量"><a href="#3-3-指定容器容量" class="headerlink" title="3.3 指定容器容量"></a>3.3 指定容器容量</h3><p>尽可能指定容器容量，以便为容器预先分配内存。这将在添加元素时最小化后续分配（通过复制和调整容器大小）。</p>
<p>在尽可能的情况下，在使用 <code>make()</code> 初始化的时候提供容量信息</p>
<p>向<code>make()</code>提供容量提示会在初始化时尝试调整 map 的大小，这将减少在将元素添加到 map 时为 map 重新分配内存。</p>
<p>注意，与 slices 不同。map capacity 提示并不保证完全的抢占式分配，而是用于估计所需的 hashmap bucket 的数量。 因此，在将元素添加到 map 时，甚至在指定 map 容量时，仍可能发生分配。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br>files, _ := os.ReadDir(<span class="hljs-string">&quot;./files&quot;</span>)<br><br>m := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]os.FileInfo, <span class="hljs-built_in">len</span>(files))<br><span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> files &#123;<br>    m[f.Name()] = f<br>&#125;<br>m 是有大小提示创建的；在运行时可能会有更少的分配。<br>反例：<br>m := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]os.FileInfo)<br><br>files, _ := os.ReadDir(<span class="hljs-string">&quot;./files&quot;</span>)<br><span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> files &#123;<br>    m[f.Name()] = f<br>&#125;<br>m 是在没有大小提示的情况下创建的； 在运行时可能会有更多分配。<br><br></code></pre></td></tr></table></figure>



<h3 id="3-4-字符串拼接用strings-Builder"><a href="#3-4-字符串拼接用strings-Builder" class="headerlink" title="3.4 字符串拼接用strings.Builder"></a>3.4 字符串拼接用strings.Builder</h3><p>综合易用性和性能，一般推荐使用 <code>strings.Builder</code> 来拼接字符串。</p>
<p>参考链接：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://geektutu.com/post/hpg-string-concat.html">https://geektutu.com/post/hpg-string-concat.html</a></p>
<h3 id="3-5-结构体集合用for还是range遍历"><a href="#3-5-结构体集合用for还是range遍历" class="headerlink" title="3.5 结构体集合用for还是range遍历"></a>3.5 结构体集合用for还是range遍历</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> Item <span class="hljs-keyword">struct</span> &#123;<br>	id  <span class="hljs-type">int</span><br>	val [<span class="hljs-number">4096</span>]<span class="hljs-type">byte</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkForStruct</span><span class="hljs-params">(b *testing.B)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> items [<span class="hljs-number">1024</span>]Item<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>		length := <span class="hljs-built_in">len</span>(items)<br>		<span class="hljs-keyword">var</span> tmp <span class="hljs-type">int</span><br>		<span class="hljs-keyword">for</span> k := <span class="hljs-number">0</span>; k &lt; length; k++ &#123;<br>			tmp = items[k].id<br>		&#125;<br>		_ = tmp<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkRangeIndexStruct</span><span class="hljs-params">(b *testing.B)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> items [<span class="hljs-number">1024</span>]Item<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>		<span class="hljs-keyword">var</span> tmp <span class="hljs-type">int</span><br>		<span class="hljs-keyword">for</span> k := <span class="hljs-keyword">range</span> items &#123;<br>			tmp = items[k].id<br>		&#125;<br>		_ = tmp<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkRangeStruct</span><span class="hljs-params">(b *testing.B)</span></span> &#123;<br>	<span class="hljs-keyword">var</span> items [<span class="hljs-number">1024</span>]Item<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;<br>		<span class="hljs-keyword">var</span> tmp <span class="hljs-type">int</span><br>		<span class="hljs-keyword">for</span> _, item := <span class="hljs-keyword">range</span> items &#123;<br>			tmp = item.id<br>		&#125;<br>		_ = tmp<br>	&#125;<br>&#125;<br><br>BenchmarkForStruct<span class="hljs-number">-8</span>             <span class="hljs-number">3769580</span>               <span class="hljs-number">324</span> ns/op<br>BenchmarkRangeIndexStruct<span class="hljs-number">-8</span>      <span class="hljs-number">3597555</span>               <span class="hljs-number">330</span> ns/op<br>BenchmarkRangeStruct<span class="hljs-number">-8</span>              <span class="hljs-number">2194</span>            <span class="hljs-number">467411</span> ns/op<br></code></pre></td></tr></table></figure>

<ul>
<li>仅遍历下标的情况下，for 和 range 的性能几乎是一样的。</li>
<li><code>items</code> 的每一个元素的类型是一个结构体类型 <code>Item</code>，<code>Item</code> 由两个字段构成，一个类型是 int，一个是类型是 <code>[4096]byte</code>，也就是说每个 <code>Item</code> 实例需要申请约 4KB 的内存。</li>
<li>在这个例子中，for 的性能大约是 range (同时遍历下标和值) 的 2000 倍。</li>
</ul>
<p>参考链接：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://geektutu.com/post/hpg-range.html">https://geektutu.com/post/hpg-range.html</a></p>
<h3 id="3-6-避免使用反射"><a href="#3-6-避免使用反射" class="headerlink" title="3.6 避免使用反射"></a>3.6 避免使用反射</h3><p>使用反射赋值，效率非常低下，如果有替代方案，尽可能避免使用反射，特别是会被反复调用的热点代码。例如 RPC 协议中，需要对结构体进行序列化和反序列化，这个时候避免使用 Go 语言自带的 <code>json</code> 的 <code>Marshal</code> 和 <code>Unmarshal</code> 方法，因为标准库中的 json 序列化和反序列化是利用反射实现的。可选的替代方案有 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/mailru/easyjson">easyjson</a>，在大部分场景下，相比标准库，有 5 倍左右的性能提升。</p>
<p>参考链接：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://geektutu.com/post/hpg-reflect.html">https://geektutu.com/post/hpg-reflect.html</a></p>
<h3 id="3-7-空结构体-struct-的使用"><a href="#3-7-空结构体-struct-的使用" class="headerlink" title="3.7 空结构体 struct{} 的使用"></a>3.7 空结构体 struct{} 的使用</h3><p>因为空结构体不占据内存空间，因此被广泛作为各种场景下的占位符使用。一是节省资源，二是空结构体本身就具备很强的语义，即这里不需要任何值，仅作为占位符。</p>
<h3 id="3-8-内存对齐对性能的影响"><a href="#3-8-内存对齐对性能的影响" class="headerlink" title="3.8 内存对齐对性能的影响"></a>3.8 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://geektutu.com/post/hpg-struct-alignment.html">内存对齐对性能的影响</a></h3><h2 id="4-异常"><a href="#4-异常" class="headerlink" title="4 异常"></a>4 异常</h2><h3 id="4-1-异常处理"><a href="#4-1-异常处理" class="headerlink" title="4.1 异常处理"></a>4.1 异常处理</h3><ul>
<li>【强制】程序中出现的任何异常都必须处理，不能忽略。</li>
<li>【强制】错误描述必须为小写，不需要标点结尾。</li>
<li>【推荐】程序中尽量避免使用panic来进行异常处理。对于必须要使用panic进行异常处理的场景，应该保证能够在单元测试或集成测试中覆盖到此场景。同时要在非测试场景下，启用recover能力。</li>
</ul>
<h3 id="4-2-日志规约"><a href="#4-2-日志规约" class="headerlink" title="4.2 日志规约"></a>4.2 日志规约</h3><ul>
<li>【推荐】日志采用分级打印方式，包含Info, Warning，Error和自定义等级。统一使用blog日志包进行日志的管理。</li>
<li>【强制】日志的内容要详尽，至少包含这几个要素：谁在什么情况下，因为什么原因，出现了什么异常，会引起什么问题。方便异常的定位。</li>
<li>【强制】Info级别用于打印在程序运行过程中必须要打印的日志信息。不能包含调试等日志信息。</li>
<li>【强制】Warning级别用于打印程序运行过程中出现的异常，但不影响程序的正常运行，需要通过Warning级别日志进行提示。</li>
<li>【强制】Error级别用于打印程序运行过程中出现的会影响业务正常运行逻辑的异常。</li>
<li>【推荐】对于自定义等级的日志，默认3级为debug日志。自定义日志的级别可根据自身需求进行调整。</li>
<li>【推荐】底层公共库中的异常应该抛出，不建议在公共库中打印相关的日志信息，应该由上层的逻辑层处理异常，并打印日志信息。</li>
</ul>
<h2 id="5-单元测试"><a href="#5-单元测试" class="headerlink" title="5 单元测试"></a>5 单元测试</h2><ul>
<li>【强制】单元测试必须遵守 AIR 原则，即具有自动化、独立性、可重复执行的特点。</li>
<li>【强制】单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执行过程必须完全自动化才有意义。输出结果禁止进行人工验证。</li>
<li>【强制】保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间禁止互相调用，也不能依赖执行的先后次序。</li>
<li>【强制】新增代码及时补充单元测试，如果新增代码影响了原有单元测试，请及时修正。</li>
<li>【推荐】对于不可测的代码建议做必要的重构，使代码变得可测，避免为了达到测试要求而编写不规范测试代码。</li>
<li>【推荐】在设计评审阶段，开发人员需要和测试人员一起确定单元测试范围，单元测试最好 覆盖所有测试用例。</li>
</ul>
<h3 id="5-1-用例编写原则"><a href="#5-1-用例编写原则" class="headerlink" title="5.1 用例编写原则"></a>5.1 用例编写原则</h3><p>当测试逻辑是重复的时候，通过 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.golang.org/subtests">subtests</a> 使用 table 驱动的方式编写 case 代码看上去会更简洁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs go">正例：<br><span class="hljs-comment">// func TestSplitHostPort(t *testing.T)</span><br><br>tests := []<span class="hljs-keyword">struct</span>&#123;<br>  give     <span class="hljs-type">string</span><br>  wantHost <span class="hljs-type">string</span><br>  wantPort <span class="hljs-type">string</span><br>&#125;&#123;<br>  &#123;<br>    give:     <span class="hljs-string">&quot;192.0.2.0:8000&quot;</span>,<br>    wantHost: <span class="hljs-string">&quot;192.0.2.0&quot;</span>,<br>    wantPort: <span class="hljs-string">&quot;8000&quot;</span>,<br>  &#125;,<br>  &#123;<br>    give:     <span class="hljs-string">&quot;192.0.2.0:http&quot;</span>,<br>    wantHost: <span class="hljs-string">&quot;192.0.2.0&quot;</span>,<br>    wantPort: <span class="hljs-string">&quot;http&quot;</span>,<br>  &#125;,<br>  &#123;<br>    give:     <span class="hljs-string">&quot;:8000&quot;</span>,<br>    wantHost: <span class="hljs-string">&quot;&quot;</span>,<br>    wantPort: <span class="hljs-string">&quot;8000&quot;</span>,<br>  &#125;,<br>  &#123;<br>    give:     <span class="hljs-string">&quot;1:8&quot;</span>,<br>    wantHost: <span class="hljs-string">&quot;1&quot;</span>,<br>    wantPort: <span class="hljs-string">&quot;8&quot;</span>,<br>  &#125;,<br>&#125;<br><br><span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;<br>  t.Run(tt.give, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> &#123;<br>    host, port, err := net.SplitHostPort(tt.give)<br>    require.NoError(t, err)<br>    assert.Equal(t, tt.wantHost, host)<br>    assert.Equal(t, tt.wantPort, port)<br>  &#125;)<br>&#125;<br>反例：<br><span class="hljs-comment">// func TestSplitHostPort(t *testing.T)</span><br><br>host, port, err := net.SplitHostPort(<span class="hljs-string">&quot;192.0.2.0:8000&quot;</span>)<br>require.NoError(t, err)<br>assert.Equal(t, <span class="hljs-string">&quot;192.0.2.0&quot;</span>, host)<br>assert.Equal(t, <span class="hljs-string">&quot;8000&quot;</span>, port)<br><br>host, port, err = net.SplitHostPort(<span class="hljs-string">&quot;192.0.2.0:http&quot;</span>)<br>require.NoError(t, err)<br>assert.Equal(t, <span class="hljs-string">&quot;192.0.2.0&quot;</span>, host)<br>assert.Equal(t, <span class="hljs-string">&quot;http&quot;</span>, port)<br><br>host, port, err = net.SplitHostPort(<span class="hljs-string">&quot;:8000&quot;</span>)<br>require.NoError(t, err)<br>assert.Equal(t, <span class="hljs-string">&quot;&quot;</span>, host)<br>assert.Equal(t, <span class="hljs-string">&quot;8000&quot;</span>, port)<br><br>host, port, err = net.SplitHostPort(<span class="hljs-string">&quot;1:8&quot;</span>)<br>require.NoError(t, err)<br>assert.Equal(t, <span class="hljs-string">&quot;1&quot;</span>, host)<br>assert.Equal(t, <span class="hljs-string">&quot;8&quot;</span>, port)<br></code></pre></td></tr></table></figure>

<p>很明显，使用 test table 的方式在代码逻辑扩展的时候，比如新增 test case，都会显得更加的清晰。</p>
<p>我们遵循这样的约定：将结构体切片称为<code>tests</code>。 每个测试用例称为<code>tt</code>。</p>
<h2 id="6-工程结构"><a href="#6-工程结构" class="headerlink" title="6 工程结构"></a>6 工程结构</h2><ul>
<li><p>【推荐】项目名可以通过中划线来连接多个单词。</p>
</li>
<li><p>【强制】工程目录名称只能使用英文小写字母</p>
</li>
<li><p>【推荐】保持 package 的名字和目录一致，包名应该为小写单词，不要使用下划线或者混合大小写，使用多级目录来划分层级。</p>
</li>
<li><p>【强制】文件名只能使用英文小写字母，如果有多个单词，中间可以使用下划线进行分隔。命名尽量望文生义。</p>
</li>
<li><p>【强制】当命名包时，请按下面规则选择一个名称：</p>
<ul>
<li>全部小写。没有大写或下划线。</li>
<li>大多数使用命名导入的情况下，不需要重命名。</li>
<li>简短而简洁。请记住，在每个使用的地方都完整标识了该名称。</li>
<li>不用复数。例如<code>net/url</code>，而不是<code>net/urls</code>。</li>
<li>不要用“common”，“util”，“shared”或“lib”。这些是不好的，信息量不足的名称。</li>
</ul>
<p>另请参阅 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.golang.org/package-names">Go 包命名规则</a> 和 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://rakyll.org/style-packages/">Go 包样式指南</a>.</p>
</li>
<li><p>【强制】工程中引入(import)的包，不能使用相对路径。必须使用相对于GOPATH的完整路径。</p>
<p>反例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;errors&quot;</span><br><br>    <span class="hljs-string">&quot;../../apimachinery/discovery&quot;</span><br>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】如果程序包名称与导入路径的最后一个元素不匹配，则必须使用导入别名。</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">import</span> (<br>  <span class="hljs-string">&quot;net/http&quot;</span><br><br>  client <span class="hljs-string">&quot;example.com/client-go&quot;</span><br>  <span class="hljs-built_in">trace</span> <span class="hljs-string">&quot;example.com/trace/v2&quot;</span><br>)<br></code></pre></td></tr></table></figure>
</li>
<li><p>【强制】工程中引入的包，需要按照“<strong>标准库包、工程内部包、第三方包”</strong>的顺序进行组织。三种包之间用空行进行分隔，这样在gofmt时不会打乱三种包之间的顺序。</p>
<p>正例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs golang"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;fmt&quot;</span><br>    <span class="hljs-string">&quot;context&quot;</span><br>    <span class="hljs-string">&quot;errors&quot;</span><br><br>    <span class="hljs-string">&quot;configcenter/src/apimachinery/discovery&quot;</span><br>    <span class="hljs-string">&quot;configcenter/src/apimachinery/rest&quot;</span><br>    <span class="hljs-string">&quot;configcenter/src/apimachinery/util&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/juju/ratelimit&quot;</span><br>)<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://golang.org/doc/effective_go.html">https://golang.org/doc/effective_go.html</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/golang/go/wiki/CodeReviewComments">https://github.com/golang/go/wiki/CodeReviewComments</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/TencentBlueKing/bk-bcs/blob/master/docs/specification/blueking-golang-code-conduct1.0.1.md">https://github.com/TencentBlueKing/bk-bcs/blob/master/docs/specification/blueking-golang-code-conduct1.0.1.md</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/xxjwxc/uber_go_guide_cn#%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-strconv-%E8%80%8C%E4%B8%8D%E6%98%AF-fmt">https://github.com/xxjwxc/uber_go_guide_cn#%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-strconv-%E8%80%8C%E4%B8%8D%E6%98%AF-fmt</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/golang/go/wiki/CommonMistakes">Go Common Mistakes</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/golang/go/wiki/CodeReviewComments">Go Code Review Comments</a></li>
</ul>

                
              </div>
            
            <hr>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/golang/" class="category-chain-item">golang</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%8E%9F%E5%88%9B/">#原创</a>
      
        <a href="/tags/golang/">#golang</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Golang代码规范</div>
      <div>https://blog.longpi1.com/2023/03/23/Golang代码规范/</div>
    </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/18/%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE/" title="关于 Linux 网络性能的 15 个优化建议">
                        <span class="hidden-mobile">关于 Linux 网络性能的 15 个优化建议</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </article></div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"UvaCwj6C0pVj9XCWuMtLaBWJ-gzGzoHsz","appKey":"w2xUk9wycItSqrREmRMDYJHY","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>






  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div>lp的个人博客 | 记录成长的过程</div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    

    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script>
  <link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css">

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script>
<script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script>
<script src="/js/events.js"></script>
<script src="/js/plugins.js"></script>


  <script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script src="/js/img-lazyload.js"></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js"></script>

  <script src="/js/local-search.js"></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script src="/js/boot.js"></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
